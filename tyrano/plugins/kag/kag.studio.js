tyrano.plugin.kag.studio={app:{},tyrano:null,rider_view:{},ipc:{},flag_push_console:!0,last_push_console_obj:{},map_watch:{},init:function(){if(-1!=window.navigator.userAgent.indexOf("TyranoStudio")){TYRANO.kag.is_studio=!0,this.ipc=require("electron"),this.ipc.ipcRenderer.on("ping",(t,e)=>{this.send("asynchronous-reply",JSON.stringify(e))}),this.ipc.ipcRenderer.on("variable-add",(t,e)=>{let a=JSON.parse(e),i=a.names;for(let t=0;t<i.length;t++){let e=i[t].name,a=""+this.kag.embScript(e);this.map_watch[e]=a,i[t].val=a}a.names=i,this.send("changed-variable",a)}),this.ipc.ipcRenderer.on("status-clear-save-data",(t,e)=>{localStorage.clear()}),this.ipc.ipcRenderer.on("status-load-save",(t,e)=>{let a=JSON.parse(e).slot;var i=setInterval(()=>{1==this.kag.stat.is_strong_stop&&(clearInterval(i),this.kag.menu.loadGame(a))},100)}),this.ipc.ipcRenderer.on("exe-tag",(t,e)=>{let a=JSON.parse(e).tag_text;this.cutTyranoScript(a)}),this.ipc.ipcRenderer.on("material-preview-position",(t,e)=>{let a=JSON.parse(e),i=a.file,s=a.category;this.insertElement(s,i)}),this.ipc.ipcRenderer.on("variable-add-all",(t,e)=>{var a=TYRANO.kag.variable,i=TYRANO.kag.stat.f,s=TYRANO.kag.stat.mp;a.f=i,a.mp=s,this.send("init-variable-all",a)}),setInterval(t=>{let e=this.kag.stat.charas;this.send("chara-update-charas",e)},5e3);var t=$("<div style='position:absolute;z-index:999999999;padding:10px;opacity:0.8;background-color:white;left:0px;top:0px'><button style='cursor:pointer'><span style=''>リロード</span></button></div>");t.draggable({scroll:!1,stop:(t,e)=>{}}),t.find("button").on("click",t=>{location.reload()}),$("body").append(t),this.send("init-variable",{})}},insertElement:function(t,e){var a="./data/"+t+"/"+e;if("fgimage"==t||"image"==t){var i=$("<div style='position:absolute;z-index:9999999999;'><div class='area_pos' style='position:absolute;width:100px;opacity:0.5;background-color:black;color:white'></div><div class='button_delete' style='position:absolute;right:0px;border:solid 1px gray;background-color:white;width:20px;height:20px;cursor:pointer' >×</div><img style='width:100%;border:solid 1px green;' src='"+a+"' /></div>");(()=>{var t=i;i.draggable({scroll:!1,stop:(e,a)=>{let i=Math.floor(a.position.left),s=Math.floor(a.position.top);t.find(".area_pos").html("x:"+i+" y:"+s);let o={left:i,top:s};this.send("material-update-pos",o)}}),i.resizable({aspectRatio:!0,handles:"all",resize:(t,e)=>{var a=$(t.target);let i={width:parseInt(a.css("width")),height:parseInt(a.css("height"))};this.send("material-update-size",i)}}),t.find(".button_delete").click(function(){t.remove()}),$(".tyrano_base").attr("ondragstart",""),$(".tyrano_base").append(t)})()}else if("bgimage"==t){TYRANO.kag.layer.getLayer("base","fore").css("background-image","url("+a+")")}},send:function(t,e){this.ipc.ipcRenderer.send(t,JSON.stringify(e))},notifyChangeVariable:function(){let t={},e=[];for(let t in this.map_watch){void 0===this.map_watch[t]&&(this.map_watch[t]="");let a=this.kag.embScript(t);this.map_watch[t]=a,e.push({name:t,val:a})}t.names=e,this.send("changed-variable",t)},pushConsole:function(t){this.last_push_console_obj=t,1==this.flag_push_console&&(this.flag_push_console=!1,setTimeout(t=>{this.flag_push_console=!0,this.send("replay-console",this.last_push_console_obj)},1e3))},complete:function(t){let e={array_save:t.kag.menu.getSaveData()};this.send("load-complete",e)},cutTyranoTag:function(t,e){TYRANO.kag.ftag.startTag(t,e)},cutTyranoScript:function(t){for(var e=TYRANO.kag.parser.parseScenario(t).array_s,a=0;a<e.length;a++){var i=e[a];this.cutTyranoTag(i.name,i.pm)}}};
